{% extends "user/home_layout.html"%}
  
{% block content %}



   <div class="content">
    <div class="row g-5">
    <div class="col-md-8">
        
      <h3 class="pb-4 mb-4 fst-italic border-bottom">
        Post by {{blog_deets.userdeets.user_fullname}}
    </h3>
    
      {% with msg=get_flashed_messages() %}
      {% if msg%}
              {% for m in msg%}
              <div class="alert alert-info">{{m}}</div>
              {%endfor%}
      {% endif%}
      {% endwith%}

    <article>
        <h5><span id="counter">{{ blog_deets.all_comments|count}}</span> comments</h5>
        <p>{{blog_deets.topic_title}}</p>
    </article>
    <hr>
    <div class="comment">
        {% if blog_deets.all_comments%}
            {% for c in blog_deets.all_comments:%}
         <p>
            {{c.comment_text}}
        </p>
        <p>by {{c.commentby.user_fullname}} on {{c.comment_date}}</p>
        {% endfor%}
        {% endif%}
    </div>
        {%if session.get('user') !=None%}
        
            <div class="form-group row">
                <label>Say something about this post</label>
                <div class="col-md-6">
                    <textarea name="comment" class="form-control" id="comment" cols="10" rows="2"></textarea>
                </div>

            </div>
            <div>
              <button type="submit" id="btncomment" class="btn btn-outline-success">Send Comment</button>
            </div>
        
        {%endif%}

    </div>

    <div class="col-md-4">
      <div class="position-sticky" style="top: 2rem;">
       

        <div class="p-4">
          
          {%if session.get('user') !=None%}
          <a href="/newtopic" class="btn btn-warning">Post New Topic</a>
          {%endif%}
          <h4 class="fst-italic">Archives</h4>
          <col class="list-unstyled mb-0">
            <li><a href="#">Performing Artistes</a></li>
            <li><a href="#">Partner Hotels</a></li>
            <li><a href="#">Event Managers</a></li>
            <li><a href="#">Bids for Contracts</a></li>
            
          </ol>
        </div>

       
      </div>
    </div>
  </div>



   </div>
  </div>
  <script src="{{url_for('static',filename='assets/jquery-3.6.1.min.js')}}"></script>
  <script type="text/javascript">
    $(document).ready(function(){
      $('#btncomment').click(function(){
      var msg = $("#comment").val()
      var userid= "{{session.get('user')}}"
      var topic= "{{blog_deets.topic_id}}"
      var data2send = "message="+msg+"&userid="+userid+"&topicid="+topic;
      
      //make an AJAX call $.ajax({key:"value",key:"value"})
      $.ajax({
        url:"/sendcomment",
        data: data2send,
        type:"GET",
        dataType:"text",
        success:function(response){
          $(".comment").append(response)
          //to increase the comment number
          var current_count = parseInt($('#counter').text()) + 1
          $('#counter').text(current_count)
          $('#comment').val('')
        },
        error:function(errormessage){
          console.log(errormessage)
        }
      })
      
    })       
      

    })

    
  </script>
 
    
{% endblock%}

   